{
  "directive": "Fix four critical issues in the architecture document identified by the super overseer:\n\n**Issue 1: Docker Binary Location (Checklist Item 69)**\n\nIn section 7.1 (Docker Build Configuration), correct the binary location:\n\n**Current (INCORRECT):**\n- Binary Location: `/var/runtime/bootstrap` (Lambda standard path)\n\n**Should be:**\n- Binary Location: `/var/task/bootstrap` or `${LAMBDA_TASK_ROOT}/bootstrap` (AWS Lambda custom runtime requirement)\n\nThe custom runtime for Lambda functions expects the binary at `/var/task/bootstrap`, NOT `/var/runtime/bootstrap`. The `/var/runtime` directory is reserved for the Lambda runtime itself.\n\n**Issue 2: eventProbe Struct Missing Field (Checklist Item 66)**\n\nIn section 5.3 (Event Probe Type), update the eventProbe struct to match the detection logic described in section 5.2:\n\n**Current (INCOMPLETE):**\n```go\ntype eventProbe struct {\n    RequestContext json.RawMessage `json:\"requestContext,omitempty\"`\n    Iterations *int `json:\"iterations,omitempty\"`\n}\n```\n\n**Should be:**\n```go\ntype eventProbe struct {\n    RequestContext json.RawMessage `json:\"requestContext,omitempty\"`\n    HTTPMethod string `json:\"httpMethod,omitempty\"`\n    Iterations *int `json:\"iterations,omitempty\"`\n}\n```\n\nThe detection logic in section 5.2 states: \"Checks for presence of 'requestContext' AND 'httpMethod' fields\" for API Gateway events. The struct must include HTTPMethod field to match this logic.\n\n**Issue 3 & 4: IAM Policy Corrections (Checklist Items 38, 70)**\n\nIn section 8.4 (IAM Policy Requirements), make the following corrections:\n\n**Remove this INCORRECT policy section:**\nThe current document has a \"Step Functions Policy\" that grants `states:StartExecution` to the Lambda execution role. This is WRONG. The Lambda function does NOT start Step Functions executions in this design. The Step Functions state machine invokes the Lambda function, not the reverse.\n\n**Add this CORRECT policy section:**\n\n**Step Functions Execution Role Policy (conditional, only if enable_step_functions = true):**\n\nCreate a new subsection explaining that the **Step Functions state machine execution role** (not the Lambda execution role) needs permission to invoke the Lambda function:\n\n```json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"lambda:InvokeFunction\"\n      ],\n      \"Resource\": \"<lambda-function-arn>\"\n    }\n  }\n}\n```\n\n**Important clarification to add:**\n\nNote that there are TWO execution roles in this architecture:\n1. **Lambda Execution Role**: Attached to the Lambda function, needs CloudWatch Logs permissions (already correct)\n2. **Step Functions Execution Role**: Attached to the state machine, needs lambda:InvokeFunction permission (this was missing)\n\nThe Lambda function DOES NOT need states:StartExecution because it never starts Step Functions executions. The Step Functions state machine starts its own execution and invokes Lambda as a task.\n\nUpdate the \"Permission Scope\" note to clarify this distinction.\n\nFix these four issues throughout the document, ensuring consistency and correctness.",
  "complete": false
}
