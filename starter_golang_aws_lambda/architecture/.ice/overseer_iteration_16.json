{
  "directive": "Add DelaySeconds field to StepFunctionOutput type for Step Functions Wait state compatibility.\n\n**Issue: Missing DelaySeconds Field in StepFunctionOutput (Checklist Item 78)**\n\nThe current StepFunctionOutput type in section 3.3 is missing a field needed for Step Functions state machine Wait states.\n\n**Current StepFunctionOutput (INCOMPLETE):**\n\n```go\ntype StepFunctionOutput struct {\n    Counter int `json:\"counter\"`\n    IterationsRemaining int `json:\"iterations_remaining\"`\n    Complete bool `json:\"complete\"`\n}\n```\n\n**Problem:**\n\nStep Functions Wait states require a delay duration in **seconds** (not milliseconds). The state machine definition will use the `DelaySeconds` field from the Lambda output to determine how long to wait before the next iteration.\n\nWithout this field, the state machine would need to:\n1. Extract DelayMs from the input\n2. Convert milliseconds to seconds\n3. Use that value in the Wait state\n\nThis is unnecessarily complex. The Lambda function should provide the delay in seconds directly.\n\n**Solution:**\n\nAdd a `DelaySeconds` field to StepFunctionOutput:\n\n```go\ntype StepFunctionOutput struct {\n    // Counter is the updated counter value after this iteration.\n    Counter int `json:\"counter\"`\n\n    // IterationsRemaining indicates how many iterations are left to perform.\n    IterationsRemaining int `json:\"iterations_remaining\"`\n\n    // Complete indicates whether the iteration cycle has finished.\n    // When true, the Step Functions state machine should terminate.\n    Complete bool `json:\"complete\"`\n\n    // DelaySeconds is the delay duration in seconds for the Step Functions Wait state.\n    // Calculated as DelayMs / 1000.0 from the input.\n    // Step Functions Wait states require duration in seconds (float64).\n    DelaySeconds float64 `json:\"delay_seconds\"`\n}\n```\n\n**Calculation Logic:**\n\nThe Lambda handler should calculate DelaySeconds from the StepFunctionInput's DelayMs field:\n\n```\nDelaySeconds = float64(input.DelayMs) / 1000.0\n```\n\nExamples:\n- DelayMs=1000 → DelaySeconds=1.0\n- DelayMs=500 → DelaySeconds=0.5\n- DelayMs=2500 → DelaySeconds=2.5\n\n**Update Section 4.3 (Step Function Handler Documentation):**\n\nAdd to the handler documentation that it calculates and returns DelaySeconds:\n\n\"The handler calculates DelaySeconds (delay duration in seconds) from the input DelayMs field for use by the Step Functions Wait state. This value is computed as DelayMs / 1000.0.\"\n\n**Step Functions State Machine Usage:**\n\nThe state machine definition will use this field in the Wait state:\n\n```json\n{\n  \"Type\": \"Wait\",\n  \"SecondsPath\": \"$.delay_seconds\",\n  \"Next\": \"InvokeLambda\"\n}\n```\n\nThis allows the state machine to dynamically wait based on the Lambda output, without needing to do unit conversion in the state machine definition.\n\n**Why float64:**\n\nStep Functions Wait states accept fractional seconds (e.g., 0.5 seconds for 500ms), so the field must be float64, not int.",
  "complete": false
}
