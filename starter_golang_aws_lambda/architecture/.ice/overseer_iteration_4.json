{
  "directive": "Define the handler function signatures for all three event types and the Router detection logic.\n\n**Handler Function Signatures (Checklist Items 10, 12, 15)**\n\nIn section 4, create \"4. Handler Functions\" with these function signatures:\n\n**4.1 API Gateway Handler** (`internal/handlers/apigateway.go`):\n- `HandleAPIGateway(ctx context.Context, req APIGatewayRequest) (APIGatewayResponse, error)`\n\nThis function processes HTTP requests from API Gateway. It should be documented to:\n- Return 200 status with APIGatewaySuccessResponse body for GET /\n- Return 404 for unsupported routes with ErrUnsupportedRoute\n- Return 500 for parsing errors with ErrInvalidEvent\n\n**4.2 Custom Event Handler** (`internal/handlers/customevent.go`):\n- `HandleCustomEvent(ctx context.Context, event json.RawMessage) (CustomEventResponse, error)`\n\nThis function echoes arbitrary JSON payloads back to the caller, wrapped in CustomEventResponse structure.\n\n**4.3 Step Function Handler** (`internal/handlers/stepfunction.go`):\n- `HandleStepFunction(ctx context.Context, input StepFunctionInput) (StepFunctionOutput, error)`\n\nThis function manages iteration state:\n- Increments Counter by 1\n- Calculates IterationsRemaining = Iterations - Counter\n- Sets Complete = true when Counter >= Iterations\n- Returns ErrIterationFailed on state management errors\n\n**Router Functions (Checklist Items 8, 21, 30, 54-56, 66)**\n\nIn section 5, create \"5. Event Router\" with:\n\n**5.1 Router Type** (`internal/router/router.go`):\n- `Router` struct (if using struct-based approach)\n- `NewRouter() *Router` constructor function\n\nOR if using function-based approach:\n- Just the DetectEventType function\n\n**5.2 Event Detection** (`internal/router/router.go`):\n- `DetectEventType(event json.RawMessage) EventType` function signature\n\nDocument the detection logic order per checklist items 54-56:\n1. Check for API Gateway structure first (presence of `requestContext` and `httpMethod` fields)\n2. Check for Step Function structure second (presence of `start`, `iterations`, `delay_ms` fields)\n3. Default to CustomEvent for other JSON payloads\n\n**5.3 Event Probe Type** (Checklist Item 66):\n- `eventProbe` struct (internal/unexported) with:\n  - `RequestContext` field for detecting API Gateway events\n  - `Iterations` field for detecting Step Function events\n\nThis struct is used for partial JSON unmarshaling during event type detection.\n\n**Specification Notes (Checklist Items 57, 59-60):**\n\nIn the documentation, note:\n- API Gateway responses require: statusCode (int), headers (map[string]string), body (string with JSON-encoded content)\n- All handlers return error types that the Lambda runtime can serialize\n- Step Function handler correctly increments counter and calculates iterations_remaining\n\nInclude all necessary imports: context, encoding/json.",
  "complete": false
}
