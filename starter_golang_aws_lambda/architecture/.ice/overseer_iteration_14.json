{
  "directive": "Fix two architectural issues identified by the super overseer regarding naming conventions and Router design consistency.\n\n**Issue 1: Missing Step Functions IAM Role Naming Pattern (Checklist Item 76)**\n\nIn section 8.3 (Resource Naming Patterns), the table lists naming patterns for Lambda function, ECR repository, API Gateway, Step Functions state machine, CloudWatch logs, and Lambda IAM role, but is missing the Step Functions execution role.\n\nAdd a row to the table:\n\n| Step Functions IAM Role | `${stack_name}-sfn-role` | `myservice-sfn-role` |\n\nThis is needed because section 8.4 documents that the Step Functions state machine has its own execution role (separate from Lambda's execution role) with lambda:InvokeFunction permission. The role needs a consistent naming pattern.\n\n**Issue 2: Router Design Inconsistency (Checklist Item 77)**\n\nThe current architecture has an inconsistent Router design in section 5:\n\n**Current (INCONSISTENT):**\n\nSection 5.1 defines:\n```go\ntype Router struct {\n    // No fields required for stateless routing\n}\n\nfunc NewRouter() *Router\n```\n\nSection 5.2 defines:\n```go\nfunc DetectEventType(event json.RawMessage) EventType\n```\n\n**The Problem:**\nWe have an empty Router struct with a constructor, but DetectEventType is defined as a package-level function (not a method on Router). This is architecturally inconsistent. Either:\n- Option A: DetectEventType should be a method on Router\n- Option B: Router struct should not exist, DetectEventType should be package-level\n\n**Recommended Solution: Option B (Package-Level Function)**\n\nSince the routing logic is stateless (no configuration, no dependencies, no instance data), a Router struct with no fields adds unnecessary complexity. The cleanest design is a simple package-level function.\n\n**Changes needed:**\n\n1. **Remove Section 5.1 entirely** (Router struct and NewRouter constructor)\n\n2. **Update Section 5.2** to clarify DetectEventType is a package-level function:\n\n```go\npackage router\n\nimport \"encoding/json\"\n\n// DetectEventType analyzes a raw Lambda event payload and determines its source.\n// This is a stateless function that uses partial JSON unmarshaling.\n//\n// Detection Logic (in order):\n// 1. API Gateway: Checks for presence of \"requestContext\" and \"httpMethod\" fields\n// 2. Step Functions: Checks for presence of \"start\", \"iterations\", \"delay_ms\" fields\n// 3. Custom Event: Default for any other valid JSON payload\n//\n// This function uses partial JSON unmarshaling via the eventProbe type to\n// efficiently detect event structure without fully parsing the entire payload.\nfunc DetectEventType(event json.RawMessage) EventType\n```\n\n3. **Update Section 6.1** (Universal Handler Function) to reflect that DetectEventType is called directly:\n\n```go\nfunc Handler(ctx context.Context, event json.RawMessage) (any, error)\n```\n\nIn the documentation, change:\n\"Use Router.DetectEventType to determine event source\"\n\nTo:\n\"Use router.DetectEventType to determine event source\"\n\n4. **Update Section 6.3** (Main Entry Point) documentation:\n\nRemove:\n\"2. Initialize the event router via NewRouter()\"\n\nChange to:\n\"The router package provides stateless event detection via router.DetectEventType\"\n\n5. **Update Section 6.4** (Import Requirements) to remove mention of NewRouter\n\n6. **Update Section 11.3** (Unit Test Organization) in the router_test.go description if it mentions Router struct\n\n**Justification:**\n\nStateless functions are simpler and more idiomatic Go than empty structs. The Router struct was adding an indirection layer with no benefit. This change makes the architecture cleaner and the implementation more straightforward.\n\nIf in the future routing needs state (e.g., configuration, logging), the struct can be added back. For now, keep it simple.",
  "complete": false
}
