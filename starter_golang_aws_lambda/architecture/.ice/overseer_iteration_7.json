{
  "directive": "Define deployment scripts and end-to-end testing infrastructure.\n\n**Deployment Scripts (Checklist Items 48-50)**\n\nIn section 9, create \"9. Deployment Scripts\":\n\n**9.1 Deployment Script** (`scripts/deploy.sh`):\n\nDocument the deployment sequence:\n1. Load STACK_NAME from config.env\n2. Build Docker image with multi-stage Dockerfile\n3. Tag image with ECR repository URL\n4. Authenticate with ECR (aws ecr get-login-password)\n5. Push image to ECR\n6. Initialize Terraform (terraform init)\n7. Apply Terraform configuration (terraform apply)\n8. Output deployment results (API Gateway URL, Lambda ARN, etc.)\n\nThe script must validate that STACK_NAME is set before proceeding.\n\n**9.2 Destroy Script** (`scripts/destroy.sh`):\n\nDocument the teardown sequence:\n1. Load STACK_NAME from config.env\n2. Run terraform destroy to remove all infrastructure\n3. Optionally delete ECR repository images\n4. Confirm all resources removed\n\n**9.3 E2E Test Script** (`scripts/test-e2e.sh`):\n\nDocument the end-to-end test lifecycle:\n1. Generate unique test stack name (e.g., test-${timestamp})\n2. Deploy test stack using deploy.sh\n3. Run E2E tests (described in next section)\n4. Clean up test stack using destroy.sh\n5. Report test results\n\n**End-to-End Testing (Checklist Items 44-47, 61-63)**\n\nIn section 10, create \"10. End-to-End Testing Infrastructure\":\n\n**10.1 Test Stack Type** (`tests/e2e/types.go`):\n\n```go\ntype TestStack struct {\n    StackName        string  // Unique test stack identifier\n    LambdaARN        string  // Deployed Lambda function ARN\n    APIGatewayURL    string  // HTTP API endpoint URL (if enabled)\n    StepFunctionARN  string  // State machine ARN (if enabled)\n    AWSRegion        string  // Deployment region\n}\n```\n\n**10.2 Stack Management Functions:**\n\n- `DeployTestStack(stackName string) (TestStack, error)` — Deploys a test stack and returns its resource identifiers\n- `CleanupTestStack(stack TestStack) error` — Destroys the test stack and all resources\n\n**10.3 Test Phases:**\n\nDocument the test structure per checklist item 44:\n\n**Phase 1: Deploy**\n- Create unique test stack with timestamp-based name\n- Wait for deployment to complete\n- Capture resource ARNs and URLs\n\n**Phase 2: Test API Gateway** (Checklist Item 61)\n- HTTP GET request to APIGatewayURL\n- Assert: Status code = 200\n- Assert: Response body contains {\"message\": \"Hello World\", \"source\": \"api-gateway\"}\n\n**Phase 3: Test Custom Event** (Checklist Item 62)\n- AWS SDK Lambda.Invoke with payload {\"foo\": \"bar\"}\n- Assert: Response contains {\"source\": \"custom-event\", \"echo\": {\"foo\": \"bar\"}}\n\n**Phase 4: Test Step Functions** (Checklist Item 63)\n- Start execution with input: {\"start\": 0, \"iterations\": 3, \"delay_ms\": 500}\n- Poll execution status until complete\n- Assert: Final output has {\"counter\": 3, \"iterations_remaining\": 0, \"complete\": true}\n\n**Phase 5: Cleanup**\n- Destroy test stack completely\n- Verify all resources removed\n\n**E2E Test Dependencies:**\n\nNote that E2E tests use AWS SDK v2 (github.com/aws/aws-sdk-go-v2) per checklist item 68. This is the ONLY place where AWS SDK v2 imports are allowed.\n\nRequired SDK packages for E2E tests:\n- github.com/aws/aws-sdk-go-v2/config (AWS config loading)\n- github.com/aws/aws-sdk-go-v2/service/lambda (Lambda invocation)\n- github.com/aws/aws-sdk-go-v2/service/sfn (Step Functions execution)",
  "complete": false
}
