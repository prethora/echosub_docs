{
  "directive": "Define the Docker build configuration and infrastructure specifications for Terraform and IAM.\n\n**Docker Configuration (Checklist Items 32-34, 58)**\n\nIn section 7, create \"7. Docker Build Configuration\":\n\n**7.1 Dockerfile Structure:**\n\nDocument the multi-stage build structure:\n\n**Builder Stage:**\n- Base: `golang:1.23-alpine` or latest stable Go image\n- Purpose: Compile the Go binary\n- Output: Statically-linked binary named `bootstrap`\n- Build flags: CGO_ENABLED=0 for static linking\n\n**Runtime Stage:**\n- Base: `public.ecr.aws/lambda/provided:al2023` (AWS Lambda custom runtime base)\n- Copy: `bootstrap` binary from builder stage to `/var/runtime/bootstrap`\n- CMD: `[\"bootstrap\"]` per AWS Lambda requirements\n\nNote that the binary must be named `bootstrap` per AWS Lambda Go custom runtime requirements (Checklist Item 58).\n\n**Terraform Infrastructure (Checklist Items 35-36, 39-43)**\n\nIn section 8, create \"8. Terraform Infrastructure\":\n\n**8.1 Variable Definitions** (`terraform/variables.tf`):\n\nDefine these Terraform variables:\n- `stack_name` (string, required): Unique identifier for the deployment\n- `enable_api_gateway` (bool, default: true): Deploy API Gateway integration\n- `enable_step_functions` (bool, default: true): Deploy Step Functions state machine\n- `enable_custom_events` (bool, default: true): Allow direct Lambda invocation\n- `aws_region` (string, default: \"us-east-1\"): AWS region for deployment\n\n**8.2 Output Definitions** (`terraform/outputs.tf`):\n\nDefine these Terraform outputs:\n- `lambda_function_arn` (always): ARN of the deployed Lambda function\n- `api_gateway_url` (conditional): HTTP API endpoint URL (only if enable_api_gateway = true)\n- `step_function_arn` (conditional): ARN of the state machine (only if enable_step_functions = true)\n\n**8.3 Resource Naming Patterns:**\n\nDocument the naming convention using STACK_NAME:\n- Lambda function: `${STACK_NAME}-lambda`\n- ECR repository: `${STACK_NAME}-repo`\n- API Gateway: `${STACK_NAME}-api`\n- Step Functions state machine: `${STACK_NAME}-state-machine`\n- CloudWatch log group: `/aws/lambda/${STACK_NAME}`\n\nAll resources must consistently use the stack_name variable for naming.\n\n**IAM Policy Requirements (Checklist Items 37-38)**\n\nIn section 8.4, define IAM policies:\n\n**8.4 Lambda Execution Role Policies:**\n\n**CloudWatch Logs Policy (always required):**\n```json\n{\n  \"Effect\": \"Allow\",\n  \"Action\": [\n    \"logs:CreateLogGroup\",\n    \"logs:CreateLogStream\",\n    \"logs:PutLogEvents\"\n  ],\n  \"Resource\": \"arn:aws:logs:*:*:*\"\n}\n```\n\n**Step Functions Policy (conditional, only if enable_step_functions = true):**\n```json\n{\n  \"Effect\": \"Allow\",\n  \"Action\": [\n    \"states:StartExecution\"\n  ],\n  \"Resource\": \"<state-machine-arn>\"\n}\n```\n\nNote: The Lambda function needs minimal permissions. No excessive permissions should be granted.",
  "complete": false
}
